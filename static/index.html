<head>
  <title>Fast Landing Page</title>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no" />
</head>

<body>
  <form id="theForm">
    <label>JSON</label>
    <input name="jsData" type="text" id="jsData" required />
    <label>Send API</label>
    <input type="button" class="btn" />
  </form>
</body>

<script>
  /*
  let fetchForm = document.getElementById("theForm")
  let formData = fetchForm.addEventListener('submit', (e) => {
    e.preventDefault();
    let fd = new FormData(fetchForm);
  
    return fd;
  });
  */
  let formData;

  document.getElementById("jsData").addEventListener("change", function(e){
    e.defaultPrevented;
  
    formData = document.getElementById("jsData").value;
  });
  const btn = document.querySelector(".btn")

  const postFetch = () => {

    let formDataParsed = JSON.parse(formData)
  
    console.log(formDataParsed[0]);
    
    fetch('/api/v1/parseJson', {　 // 送信先URL
      method: 'post', // 通信メソッド
      header: {
        'Content-Type': 'application/json' // JSON形式のデータのヘッダー
      },
      body: formDataParsed[0] // JSON形式のデータ
    })
      .then(response => response.text())
      .then(formDataParsed => {
        console.log(formDataParsed);
      })
  };
  
  btn.addEventListener('click', postFetch, false);

/*
  const getFormJSON = (form) => {
    const data = new FormData(form);
    return Array.from(data.keys()).reduce((result, key) => {
      result[key] = data.get(key);
      return result;
    }, {});
  };

  document.addEventListener("DOMContentLoaded", function () {
    let theForm = document.querySelector("theForm");
    let output = document.getElementById("output");
    
    theForm.addEventListener("submit", function(e){
      e.preventDefault()

      let data = document.getElementById('jsData')

      console.log('///////////////////////////')
      let fd = new FormData(theForm);
      fd.append('data', JSON.stringify(data));
  
      fetch('/', {　 // 送信先URL
        method: 'post', // 通信メソッド
        header: {
          'Content-Type': 'application/json' // JSON形式のデータのヘッダー
        },
        body: fd // JSON形式のデータ
      })
        .then(response => response.text())
        .then(fd => {
          console.log(fd);
        })
    })
  })

*/
</script>


</html>